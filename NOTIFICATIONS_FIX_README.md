# Исправление уведомлений PWA

## Что было исправлено

Проблема была в том, что уведомления использовали `setTimeout` в основном потоке приложения, что означало, что когда PWA закрыто на смартфоне, таймеры останавливались и уведомления не приходили.

## Решение

1. **Обновлен Service Worker** (`public/sw.js`):
   - Добавлена поддержка фоновых уведомлений через Service Worker
   - Реализована система планирования напоминаний в фоновом режиме
   - Добавлена обработка кликов по уведомлениям
   - Добавлена функция тестирования уведомлений

2. **Обновлен Dashboard.tsx**:
   - Удалена старая логика с `setTimeout`
   - Добавлена отправка сообщений в Service Worker для планирования напоминаний
   - Добавлена кнопка тестирования уведомлений

3. **Обновлен манифест** (`public/manifest.json`):
   - Добавлены права на уведомления

4. **Обновлена регистрация Service Worker** (`index.html`):
   - Улучшена обработка обновлений Service Worker

## Как тестировать

### На мобильном устройстве:

1. **Установите PWA**:
   - Откройте приложение в браузере
   - Нажмите "Установить" или "Добавить на главный экран"
   - Подтвердите установку

2. **Включите уведомления**:
   - Откройте приложение
   - Перейдите в настройки
   - Нажмите "Включить уведомления"
   - Разрешите уведомления в браузере

3. **Протестируйте уведомления**:
   - В настройках нажмите "Тест уведомления"
   - Должно появиться тестовое уведомление

4. **Проверьте фоновые уведомления**:
   - Закройте приложение полностью
   - Подождите время, установленное в интервалах напоминаний
   - Уведомления должны приходить даже когда приложение закрыто

### На компьютере:

1. Откройте приложение в Chrome/Edge
2. Включите уведомления через настройки
3. Протестируйте кнопкой "Тест уведомления"
4. Закройте вкладку браузера
5. Уведомления должны приходить в фоновом режиме

## Особенности реализации

- **Фоновые уведомления**: Теперь работают через Service Worker, который продолжает работать даже когда приложение закрыто
- **Интерактивные уведомления**: Добавлены кнопки "Открыть приложение" и "Отложить"
- **Автоматическое планирование**: После показа уведомления автоматически планируется следующее
- **Надежность**: Добавлен Background Sync для случаев потери соединения

## Файлы, которые были изменены

- `public/sw.js` - основной Service Worker с логикой уведомлений
- `src/pages/Dashboard.tsx` - интеграция с Service Worker
- `public/manifest.json` - права на уведомления
- `index.html` - улучшенная регистрация Service Worker

## Отладка

Если уведомления не работают:

1. Проверьте консоль браузера на ошибки
2. Убедитесь, что Service Worker зарегистрирован (DevTools > Application > Service Workers)
3. Проверьте права на уведомления в настройках браузера
4. Убедитесь, что PWA установлено как приложение

## Совместимость

- ✅ Chrome/Edge (Android, Windows, macOS)
- ✅ Firefox (Android, Windows, macOS)
- ✅ Safari (iOS 16.4+, macOS)
- ⚠️ Старые версии браузеров могут не поддерживать все функции
