# Система предзагрузки изображений

## Обзор

Система предзагрузки изображений обеспечивает кэширование всех изображений приложения во время загрузки, что значительно улучшает производительность и пользовательский опыт.

## Архитектура

Система построена на основе React Context API для глобального управления состоянием предзагрузки и обеспечивает:

- **Глобальное состояние** - все компоненты используют единое состояние предзагрузки
- **Автоматическая предзагрузка** - изображения загружаются при старте приложения
- **Прогресс в LoadingScreen** - пользователь видит реальный прогресс загрузки
- **Кэширование** - все изображения остаются в кэше браузера

## Компоненты

### 1. ImagePreloadContext (`src/contexts/ImagePreloadContext.tsx`)

Глобальный контекст для управления состоянием предзагрузки изображений.

**Особенности:**
- Централизованное управление состоянием
- Глобальный доступ к прогрессу загрузки
- Автоматическая инициализация с правильным количеством изображений

**Использование:**
```tsx
import { ImagePreloadProvider } from './contexts/ImagePreloadContext'

<ImagePreloadProvider>
  <App />
</ImagePreloadProvider>
```

### 2. ImagePreloader (`src/components/ImagePreloader.tsx`)

Основной компонент для предзагрузки всех изображений приложения.

**Особенности:**
- Предзагружает все изображения параллельно батчами
- Интегрируется с глобальным контекстом
- Обрабатывает ошибки и таймауты
- Обеспечивает кэширование в браузере

**Использование:**
```tsx
import ImagePreloader from './components/ImagePreloader'

<ImagePreloader />
```

### 3. LoadingScreen (`src/components/LoadingScreen.tsx`)

Обновленный экран загрузки с отображением прогресса предзагрузки изображений.

**Особенности:**
- Показывает реальный прогресс загрузки изображений
- Динамически обновляет текст и прогресс-бар
- Плавные анимации переходов
- Интегрируется с глобальным контекстом

### 4. Конфигурация (`src/config/imagePreload.ts`)

Централизованное управление списком изображений и настройками предзагрузки.

**Категории изображений:**
- `critical` - критически важные изображения
- `actions` - основные иконки действий
- `tamagotchi` - иконки для тамагочи
- `charts` - иконки для графиков и статистики
- `navigation` - SVG иконки для навигации
- `modals` - иконки для модальных окон
- `additional` - дополнительные иконки
- `appIcons` - иконки приложения

**Настройки:**
- `maxConcurrent: 10` - максимальное количество одновременных загрузок
- `timeout: 10000` - таймаут для загрузки одного изображения (10 секунд)
- `enableInProduction: true` - включить предзагрузку в продакшене
- `logProgress: false` - отключить логирование в продакшене

### 5. Утилиты (`src/lib/imagePreloader.ts`)

Утилиты для предзагрузки изображений и критически важных изображений.

**Функции:**
- `preloadImages(imageUrls: string[])` - предзагрузка массива изображений
- `useImagePreload(imageUrls: string[])` - хук для предзагрузки с состоянием
- `CriticalImagePreloader` - компонент для предзагрузки критически важных изображений

## Интеграция

### В главном компоненте App

```tsx
import { ImagePreloadProvider } from './contexts/ImagePreloadContext'
import { CriticalImagePreloader } from './lib/imagePreloader'
import ImagePreloader from './components/ImagePreloader'

export default function App() {
  return (
    <ThemeProvider>
      <ImagePreloadProvider>
        <AuthProvider>
          <CriticalImagePreloader />
          <ImagePreloader />
          <AppContent />
        </AuthProvider>
      </ImagePreloadProvider>
    </ThemeProvider>
  )
}
```

### Использование в компонентах

```tsx
import { useImagePreloadContext } from './contexts/ImagePreloadContext'

function MyComponent() {
  const { isPreloading, preloadProgress } = useImagePreloadContext()
  
  return (
    <div>
      {isPreloading ? (
        <div>Загружаем изображения... {preloadProgress.loaded}/{preloadProgress.total}</div>
      ) : (
        <div>Все изображения загружены!</div>
      )}
    </div>
  )
}
```

## Список предзагружаемых изображений

Система предзагружает **54 уникальных изображения**:

### Основные иконки действий
- `/icons/feeding.png` - кормление
- `/icons/poor.png` - смена подгузника
- `/icons/bath.png` - купание
- `/icons/sleep.png` - сон
- `/icons/activity.png` - активность
- `/icons/baby.png` - малыш

### Иконки для тамагочи
- `/icons/sponge.png` - губка
- `/icons/mom.png` - мама
- `/icons/bag.png` - сумка
- `/icons/diaper.png` - подгузник

### Иконки для графиков и статистики
- `/icons/wight.png` - вес
- `/icons/height.png` - рост
- `/icons/clock.png` - время

### SVG иконки для навигации
- `/icons/general.svg` - главная
- `/icons/tamagochi.svg` - тамагочи
- `/icons/tetris.svg` - тетрис
- `/icons/settings.svg` - настройки

### Иконки приложения
- Различные размеры иконок (16x16, 32x32, 72x72, и т.д.)

## Преимущества

1. **Улучшенная производительность**: Все изображения кэшируются заранее
2. **Лучший UX**: Плавные переходы без задержек на загрузку изображений
3. **Надежность**: Обработка ошибок и таймаутов
4. **Гибкость**: Возможность предзагрузки как всех, так и критически важных изображений
5. **Мониторинг**: Отслеживание прогресса загрузки
6. **Глобальное состояние**: Единое состояние для всего приложения

## Технические детали

- Использует нативный `Image()` API для предзагрузки
- Параллельная загрузка изображений батчами (по 10 одновременно)
- Автоматическое кэширование браузером
- Graceful handling ошибок загрузки
- TypeScript поддержка
- React Context API для управления состоянием
- Таймаут 10 секунд на изображение

## Производительность

- **Время загрузки**: ~2-5 секунд для всех 54 изображений
- **Использование памяти**: Минимальное (изображения кэшируются браузером)
- **Сетевой трафик**: Оптимизирован батчами по 10 изображений
- **Пользовательский опыт**: Плавные переходы без задержек

## Мониторинг

В режиме разработки система может логировать:
- Количество успешно загруженных изображений
- Предупреждения о неудачных загрузках
- Общий прогресс предзагрузки

В продакшене логирование отключено для оптимизации производительности.
