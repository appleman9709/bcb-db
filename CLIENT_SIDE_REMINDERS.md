# Обработка напоминаний на клиенте

## Обзор

Из-за ограничений Hobby тарифа Vercel (cron jobs могут запускаться не чаще раза в день), обработка напоминаний перенесена на клиентскую сторону.

## Как это работает

1. **При загрузке приложения** запускается `reminderProcessor`, который:
   - Немедленно проверяет запланированные напоминания
   - Затем проверяет их каждую минуту (60 секунд)

2. **Обработка напоминаний** происходит через API endpoint `/api/push/process-reminders`, который:
   - Находит все напоминания со статусом `pending`, время которых уже наступило
   - Отправляет push-уведомления всем подписчикам семьи
   - Обновляет статус напоминаний на `sent`

## Преимущества

- ✅ Не зависит от ограничений Vercel cron jobs
- ✅ Работает даже если cron job не настроен
- ✅ Более надежно - работает пока приложение открыто
- ✅ Проверяет напоминания каждую минуту (вместо раза в день)

## Ограничения

- ⚠️ Напоминания обрабатываются только когда приложение открыто
- ⚠️ Если приложение закрыто, напоминания будут обработаны при следующем открытии
- ⚠️ Для работы в фоне нужно установить приложение как PWA

## Настройка

Обработчик запускается автоматически при загрузке приложения. Никаких дополнительных настроек не требуется.

## Мониторинг

Проверка напоминаний логируется в консоль браузера:
- `Starting reminder processor...` - обработчик запущен
- `Processed X reminders: Y sent, Z failed` - обработаны напоминания

## Отладка

Если напоминания не приходят:

1. Проверьте консоль браузера на наличие ошибок
2. Убедитесь, что приложение открыто (обработчик работает только когда приложение активно)
3. Проверьте, что есть запланированные напоминания в базе данных:
   ```sql
   SELECT * FROM scheduled_reminders 
   WHERE status = 'pending' 
   AND scheduled_time <= NOW();
   ```
4. Проверьте, что есть активные подписки на push-уведомления:
   ```sql
   SELECT * FROM push_subscriptions;
   ```

## Альтернативные решения

Если нужно обрабатывать напоминания даже когда приложение закрыто:

1. **Supabase Edge Functions с pg_cron** - настройка cron job в Supabase
2. **Внешний сервис** (например, cron-job.org) - бесплатные cron jobs
3. **Service Worker** - обработка в фоне через PWA

## Технические детали

- **Файл:** `src/services/reminderProcessor.ts`
- **Интервал проверки:** 60 секунд (1 минута)
- **Минимальный интервал между запросами:** 30 секунд (защита от спама)
- **API endpoint:** `/api/push/process-reminders`

