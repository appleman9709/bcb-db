# –¢–∞–±–ª–∏—Ü–∞ —Ä–µ–∫–æ—Ä–¥–æ–≤ —Ç–µ—Ç—Ä–∏—Å–∞

## –û–ø–∏—Å–∞–Ω–∏–µ

–î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ —Ç–∞–±–ª–∏—Ü—ã —Ä–µ–∫–æ—Ä–¥–æ–≤ –¥–ª—è –∏–≥—Ä—ã —Ç–µ—Ç—Ä–∏—Å, –∫–æ—Ç–æ—Ä–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å —á–ª–µ–Ω–∞–º–∏ —Å–µ–º—å–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

## –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### 1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **–¢–∞–±–ª–∏—Ü–∞ `tetris_records`** - —Ö—Ä–∞–Ω–∏—Ç —Ä–µ–∫–æ—Ä–¥—ã –∏–≥—Ä–æ–∫–æ–≤
- **–§—É–Ω–∫—Ü–∏–∏ PostgreSQL** –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∫–æ—Ä–¥–æ–≤ —Å–µ–º—å–∏ –∏ –ª–∏—á–Ω—ã—Ö —Ä–µ–∫–æ—Ä–¥–æ–≤
- **–ò–Ω–¥–µ–∫—Å—ã** –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- **–ü–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** –¥–ª—è –∑–∞—â–∏—Ç—ã –¥–∞–Ω–Ω—ã—Ö

### 2. Backend (DataService)
- `getFamilyTetrisRecords()` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–ø-10 —Ä–µ–∫–æ—Ä–¥–æ–≤ —Å–µ–º—å–∏
- `getUserTetrisRecords()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ª–∏—á–Ω—ã—Ö —Ä–µ–∫–æ—Ä–¥–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `addTetrisRecord()` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ä–µ–∫–æ—Ä–¥–∞
- `getTetrisRecordRank()` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ä–∞–Ω–≥–∞ —Ä–µ–∫–æ—Ä–¥–∞

### 3. Frontend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- **TetrisLeaderboard** - –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å —Ç–∞–±–ª–∏—Ü–µ–π —Ä–µ–∫–æ—Ä–¥–æ–≤
- **SimpleTetrisPage** - –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è —Ç–µ—Ç—Ä–∏—Å–∞ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π —Ä–µ–∫–æ—Ä–¥–æ–≤
- **TetrisPage** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–Ω–µ—à–Ω–µ–≥–æ —Ç–µ—Ç—Ä–∏—Å–∞ —á–µ—Ä–µ–∑ iframe

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### TetrisRecord
```typescript
interface TetrisRecord {
  id: number
  family_id: number
  user_id: string
  player_name: string
  score: number
  level: number
  lines_cleared: number
  game_duration_seconds: number
  pieces_placed: number
  game_mode: string
  created_at: string
}
```

### TetrisRecordWithRank
```typescript
interface TetrisRecordWithRank extends TetrisRecord {
  rank: number
}
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. –í React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö
```typescript
import { useAuth } from '../contexts/AuthContext'
import { dataService } from '../services/dataService'

// –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∫–æ—Ä–¥–æ–≤ —Å–µ–º—å–∏
const familyRecords = await dataService.getFamilyTetrisRecords(10)

// –ü–æ–ª—É—á–µ–Ω–∏–µ –ª–∏—á–Ω—ã—Ö —Ä–µ–∫–æ—Ä–¥–æ–≤
const userRecords = await dataService.getUserTetrisRecords(10)

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ä–µ–∫–æ—Ä–¥–∞
await dataService.addTetrisRecord({
  player_name: '–ò–≥—Ä–æ–∫',
  score: 1500,
  level: 3,
  lines_cleared: 15,
  game_duration_seconds: 180,
  pieces_placed: 25,
  game_mode: 'classic'
})
```

### 2. –í HTML —Ç–µ—Ç—Ä–∏—Å–µ
–í–Ω–µ—à–Ω–∏–π —Ç–µ—Ç—Ä–∏—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–µ–∫–æ—Ä–¥—ã —á–µ—Ä–µ–∑ `postMessage`:
```javascript
// –û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∫–æ—Ä–¥–∞ –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
this.sendRecordToParent(score, level, lines, duration, piecesPlaced)
```

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
–í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL —Å–∫—Ä–∏–ø—Ç `supabase_schema.sql` –≤ Supabase –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã –∏ —Ñ—É–Ω–∫—Ü–∏–π.

### 2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `test_tetris_records.sql` –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
- –†–µ–∫–æ—Ä–¥—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –æ–∫–æ–Ω—á–∞–Ω–∏–∏ –∏–≥—Ä—ã
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –∫–∞–∫ React –≤–µ—Ä—Å–∏—è, —Ç–∞–∫ –∏ HTML –≤–µ—Ä—Å–∏—è —Ç–µ—Ç—Ä–∏—Å–∞
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É –≤—Å–µ–º–∏ —á–ª–µ–Ω–∞–º–∏ —Å–µ–º—å–∏

### –†–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ
- –†–µ–∫–æ—Ä–¥—ã —Å–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –ø–æ —Å—á–µ—Ç—É (–ø–æ —É–±—ã–≤–∞–Ω–∏—é)
- –ü—Ä–∏ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–º —Å—á–µ—Ç–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è
- –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Ä–∞–Ω–≥ –∫–∞–∂–¥–æ–≥–æ —Ä–µ–∫–æ—Ä–¥–∞

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ç—Ä–µ–±—É—é—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –î–∞–Ω–Ω—ã–µ –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ —Å–µ–º—å–µ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- Row Level Security –≤–∫–ª—é—á–µ–Ω

## –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å

### –ö–Ω–æ–ø–∫–∞ "üèÜ –†–µ–∫–æ—Ä–¥—ã"
- –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å —Ç–∞–±–ª–∏—Ü–µ–π —Ä–µ–∫–æ—Ä–¥–æ–≤
- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Ä–µ–∫–æ—Ä–¥–∞–º–∏ —Å–µ–º—å–∏ –∏ –ª–∏—á–Ω—ã–º–∏ —Ä–µ–∫–æ—Ä–¥–∞–º–∏
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏–≥—Ä—ã

### –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–≥—Ä—ã
- –ö–Ω–æ–ø–∫–∞ "–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∫–æ—Ä–¥—ã"
- –ö–Ω–æ–ø–∫–∞ "–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞"

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- **–í—Ä–µ–º—è –∏–≥—Ä—ã** - –æ—Ç –Ω–∞—á–∞–ª–∞ –¥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è
- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∏–≥—É—Ä** - —Å–∫–æ–ª—å–∫–æ —Ñ–∏–≥—É—Ä –±—ã–ª–æ —Ä–∞–∑–º–µ—â–µ–Ω–æ
- **–£—Ä–æ–≤–µ–Ω—å –∏ –ª–∏–Ω–∏–∏** - —Ç–µ–∫—É—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å –∏–≥—Ä—ã
- **–†–µ–∂–∏–º –∏–≥—Ä—ã** - –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Ç–µ—Ç—Ä–∏—Å

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–∏—Å—Ç–µ–º–æ–π
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å–∏—Å—Ç–µ–º—É –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å DataService
- –°–æ–≤–º–µ—Å—Ç–∏–º–∞ —Å —Å–∏—Å—Ç–µ–º–æ–π —Å–µ–º–µ–π –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è** - —Å–∏—Å—Ç–µ–º–∞ –Ω–∞–≥—Ä–∞–¥ –∑–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
2. **–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ —Ç—É—Ä–Ω–∏—Ä—ã** - —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è –º–µ–∂–¥—É —Å–µ–º—å—è–º–∏
3. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - –¥–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏–≥—Ä
4. **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ä–µ–∂–∏–º—ã** - —Ä–∞–∑–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ç–µ—Ç—Ä–∏—Å–∞
5. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** - –æ–ø–æ–≤–µ—â–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö —Ä–µ–∫–æ—Ä–¥–∞—Ö
